# Server サイド PHP ファイル一覧と説明

このディレクトリには、ActivityMonitor アプリケーションのサーバーサイドロジックを担当する PHP ファイルが含まれています。主な機能は、データの受信、データベースへの保存、およびフロントエンドへのデータ提供（API）と表示（HTML）です。

## ユーティリティ (utils/)

### 1. `utils/ScoreCalculator.php`
- **目的**: 生産性 (Productivity) と集中度 (Focus) のスコア計算ロジック。
- **内容**:
    - C# 版 `ActivityMonitor.cs` のロジックを PHP に移植したもの。
    - `ProductivityCalculator`: 入力密度や使用アプリケーションの重み付けから生産性を算出。
    - `FocusCalculator`: ステータス(没入度、中断、安定性)から集中度を算出。
    - `ActivityCommentGenerator`: スコアや状態に基づいたコメント（例：「安定した作業が行われていました」）を生成。

## コア・データベース関連

### 2. `api.php`
- **目的**: クライアントアプリからのデータ受信と保存。
- **内容**:
    - POST リクエストで JSON データを受け取る。
    - `activity_records` テーブルへデータを挿入する。
    - 重複データ（同じマシン・同じ uptime）のチェックを行い、新規データのみ保存する。

### 3. `db_connect.php`
- **目的**: データベース接続の共通化。
- **内容**:
    - `db_config.ini` を読み込み、PDO を使用して MySQL データベースに接続する。

## フロントエンド ページ (HTML/UI)

### 4. `index.php` (ホーム - マシン一覧)
- **目的**: アプリケーションのトップページ。
- **内容**:
    - マシンごとの平均生産性・集中度スコア、総作業時間を一覧表示する。
    - `daily_list.php` へのリンクを提供する。

### 5. `daily_list.php` (日次一覧)
- **目的**: 特定のマシンの日別スコア一覧表示。
- **内容**:
    - 日付ごとに平均/最大生産性・集中度を表示する。
    - 各日の詳細 (`detail.php`) へのリンクを提供する。

### 6. `detail.php` (詳細ビュー)
- **目的**: 特定の日・マシンの詳細アクティビティ表示。
- **内容**:
    - 24時間のタイムラインチャート、アプリ別使用比率円グラフを表示。
    - 30分単位のスコア詳細テーブルと、生のアクティビティログを表示する。

### 7. `attendance.php` (勤怠 - マシン一覧)
- **目的**: マシンごとの勤怠サマリー表示。
- **内容**:
    - 平均始業/就業時間、総勤務時間、ロック時間、アイドル時間を表示する。
    - `attendance_daily.php` へのリンクを提供する。

### 8. `attendance_daily.php` (勤怠 - 日次詳細)
- **目的**: 特定のマシンの日別勤怠詳細表示。
- **内容**:
    - 日付ごとの始業・終業時間、実働時間を一覧表示する。

### 9. `process_analysis.php` (プロセス分析 - 一覧)
- **目的**: アプリケーション（プロセス）ごとの使用統計表示。
- **内容**:
    - プロセス名ごとの合計時間、閲覧時間（マウスのみ）、編集時間（キーボードあり）を表示する。
    - `process_machine_list.php` へのリンクを提供する。

### 10. `process_machine_list.php` (プロセス詳細 - マシン別)
- **目的**: 特定のプロセスを使用しているマシンごとの統計。
- **内容**:
    - 選択したプロセスをどのマシンがどれくらい使用しているかを表示する。
    - `process_detail.php` へのリンクを提供する。

### 11. `process_detail.php` (プロセス詳細ログ)
- **目的**: 特定のプロセス・マシンの詳細ログ表示。
- **内容**:
    - 選択したプロセスに関する生のアクティビティログ（ウィンドウタイトル、操作量など）を時系列で表示する。

## API エンドポイント (データ取得用)

### 12. `get_data.php`
- **目的**: `detail.php` 用のデータ取得。
- **説明**: 指定期間・マシンの生データを取得し、`ScoreCalculator` を用いてスコア計算を行った結果を JSON で返す。

### 13. `get_daily_list.php`
- **目的**: `daily_list.php` 用のデータ取得。
- **説明**: マシンごとの日別スコア集計データを返す。

### 14. `get_machine_list.php`
- **目的**: `index.php` 用のデータ取得。
- **説明**: 全期間（または指定期間）のマシンごとの平均スコア集計データを返す。

### 15. `get_attendance_list.php`
- **目的**: `attendance.php` 用のデータ取得。
- **説明**: マシンごとの勤怠集計（始業・終業・稼働時間など）データを返す。

### 16. `get_attendance_daily.php`
- **目的**: `attendance_daily.php` 用のデータ取得。
- **説明**: 特定マシンの日別勤怠データを返す。

### 17. `get_process_list.php`
- **目的**: `process_analysis.php` 用のデータ取得。
- **説明**: プロセスごとの合計・閲覧・編集時間を集計して返す。

### 18. `get_process_machine_list.php`
- **目的**: `process_machine_list.php` 用のデータ取得。
- **説明**: 特定プロセスにおけるマシンごとの使用状況を集計して返す。

### 19. `get_process_detail.php`
- **目的**: `process_detail.php` 用のデータ取得。
- **説明**: 特定プロセス・マシンの生ログデータを返す。
